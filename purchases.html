<!-- ProfitPlate v2 Purchases Page -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Purchases – ProfitPlate v2</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <!-- Translation helper -->
    <script src="assets/lang.js"></script>
  </head>
  <body>
    <div id="site-header"></div>
    <div class="page">
      <h1 data-i18n="purchases_title">Purchases</h1>
      <p class="text-muted" style="margin-bottom:24px;">
        This is your ingredient base. Add items you buy, organise them by
        category, and keep supplier prices up to date. Recipes will use
        everything you add here.
      </p>
      <button class="btn btn-primary" onclick="toggleAddForm()">
        Add item
      </button>
      <!-- Add item form -->
      <div id="add-item-form" class="mt-20 hidden">
        <h2 id="add-item-title">Add a new purchase item</h2>
        <form id="purchase-form">
          <div style="margin-bottom:16px;">
            <label for="item-name">Name</label><br />
            <input id="item-name" required />
          </div>
          <div style="display:flex; flex-wrap:wrap; gap:16px; margin-bottom:16px;">
            <div style="flex:1; min-width:200px;">
              <label for="item-category">Category</label><br />
              <select id="item-category">
                <option value="">Select…</option>
                <option>Meat &amp; Fish</option>
                <option>Dairy &amp; Eggs</option>
                <option>Vegetables &amp; Fruit</option>
                <option>Dry Goods</option>
                <option>Spices &amp; Condiments</option>
                <option>Other</option>
              </select>
            </div>
            <div style="flex:1; min-width:200px;">
              <label for="item-subtype">Sub‑type</label><br />
              <select id="item-subtype">
                <option value="">Select…</option>
              </select>
            </div>
            <div style="flex:1; min-width:200px;">
              <label for="item-unit">Unit (for recipes)</label><br />
              <select id="item-unit">
                <option value="kg">kg</option>
                <option value="g">gr</option>
                <option value="l">L</option>
                <option value="ml">ml</option>
                <option value="pcs">pcs</option>
              </select>
            </div>
            <div style="flex:1; min-width:200px;">
              <label for="item-price">Purchase price (per recipe unit)</label><br />
              <input id="item-price" type="number" min="0" step="0.0001" />
            </div>
          </div>
          <div style="display:flex; flex-wrap:wrap; gap:16px; margin-bottom:16px;">
            <div style="flex:1; min-width:200px;">
              <label for="item-supplier">Supplier</label><br />
              <input id="item-supplier" />
            </div>
            <div style="flex:1; min-width:200px;">
              <label for="item-invoice-number">Invoice number</label><br />
              <input id="item-invoice-number" />
            </div>
            <div style="flex:1; min-width:200px;">
              <label for="item-invoice-date">Invoice date</label><br />
              <input id="item-invoice-date" type="date" />
            </div>
          </div>
          <div style="margin-bottom:16px;">
            <label for="item-notes">Notes (storage, etc.)</label><br />
            <textarea id="item-notes" rows="2"></textarea>
          </div>
          <!-- Pack helper -->
          <details style="margin-bottom:16px;">
            <summary style="cursor:pointer;">Use pack helper</summary>
            <p class="text-muted" style="margin-top:8px;">
              Example: 100 gr for 5 € → auto‑converts price per unit.
            </p>
            <div style="display:flex; flex-wrap:wrap; gap:16px; margin-top:8px;">
              <div style="flex:1; min-width:160px;">
                <label for="pack-qty">Pack quantity</label><br />
                <input id="pack-qty" type="number" min="0" step="0.001" />
              </div>
              <div style="flex:1; min-width:160px;">
                <label for="pack-unit">Pack unit</label><br />
                <select id="pack-unit">
                  <option value="kg">kg</option>
                  <option value="g">gr</option>
                  <option value="l">L</option>
                  <option value="ml">ml</option>
                  <option value="pcs">pcs</option>
                </select>
              </div>
              <div style="flex:1; min-width:160px;">
                <label for="pack-price">Pack price (€)</label><br />
                <input id="pack-price" type="number" min="0" step="0.0001" />
              </div>
              <div style="display:flex; align-items:end;">
                <button type="button" class="btn btn-secondary" onclick="fillPriceFromPack()">
                  Use pack
                </button>
              </div>
            </div>
          </details>
          <!-- Price history -->
          <div id="price-history-block" class="hidden mt-20">
            <h3>Price history</h3>
            <p class="text-muted">
              Last 10 recorded price changes for this ingredient (newest first).
            </p>
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Price / unit</th>
                </tr>
              </thead>
              <tbody id="price-history-body"></tbody>
            </table>
          </div>
          <div style="margin-top:24px; display:flex; gap:12px;">
            <button type="button" class="btn btn-secondary" onclick="toggleAddForm()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Save item</button>
          </div>
        </form>
      </div>
      <hr />
      <h2>Recently updated</h2>
      <div id="recent-list" class="mt-10"></div>
      <hr />
      <h2>All ingredients</h2>
      <div style="display:flex; flex-wrap:wrap; gap:16px; align-items:center; margin-bottom:12px;">
        <input id="search-input" type="search" placeholder="Search…" style="flex:1; min-width:200px;" />
        <select id="category-filter" style="min-width:200px;">
          <option value="">All categories</option>
          <option>Meat &amp; Fish</option>
          <option>Dairy &amp; Eggs</option>
          <option>Vegetables &amp; Fruit</option>
          <option>Dry Goods</option>
          <option>Spices &amp; Condiments</option>
          <option>Other</option>
        </select>
        <button type="button" class="btn btn-secondary" onclick="window.print()">
          Print list
        </button>
      </div>
      <table id="ingredients-table">
        <thead>
          <tr>
            <th>Ingredient</th>
            <th>Category</th>
            <th>Sub‑type</th>
            <th>Supplier</th>
            <th>Invoice #</th>
            <th>Unit</th>
            <th>Latest price</th>
            <th>Last updated</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="purchase-table"></tbody>
      </table>
    </div>
    <!-- Scripts -->
    <script src="assets/header.js"></script>
    <script src="assets/app.js"></script>
    <script src="assets/tour.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        if (typeof renderHeader === 'function') renderHeader('purchases');
        // Apply translations after header has rendered
        if (typeof translatePage === 'function') translatePage();
      });
    </script>
  </body>
</html>