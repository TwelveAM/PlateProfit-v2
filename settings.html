<!-- ProfitPlate v2 Settings Page -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings – ProfitPlate v2</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <!-- Translation helper -->
    <script src="assets/lang.js"></script>
  </head>
  <body>
    <div id="site-header"></div>
    <div class="page">
      <h1 data-i18n="settings_title">Settings</h1>
      <p class="text-muted" style="margin-bottom:24px;">
        Adjust how ProfitPlate behaves in your kitchen – currency, display options
        and data controls. In the real app, these settings would be stored in
        your account and synced across devices.
      </p>
      <!-- General settings -->
      <div class="settings-box" id="settings-general">
        <div class="settings-title" data-i18n="settings_general">General</div>
        <div style="margin-bottom:16px;">
          <label for="currency-select">Currency</label><br />
          <select id="currency-select"></select>
        </div>
        <div style="margin-bottom:16px;">
          <label for="number-format-select">Number format</label><br />
          <select id="number-format-select">
            <option value="eu">1.234,56 (EU style)</option>
            <option value="us">1,234.56 (US/UK style)</option>
          </select>
        </div>

        <!-- Language selection -->
        <div style="margin-bottom:16px;">
          <label for="language-select">Language</label><br />
          <select id="language-select">
            <option value="en">English</option>
            <option value="ro">Română</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
          </select>
        </div>
      </div>
      <!-- Behaviour settings -->
      <div class="settings-box" id="settings-behaviour">
        <div class="settings-title" data-i18n="settings_behaviour">Behaviour</div>
        <label style="display:block; margin-bottom:12px;">
          <input type="checkbox" id="auto-recalc-toggle" /> Auto‑recalculate
          recipes
        </label>
        <p class="settings-note">
          When an ingredient price changes in Purchases, update recipe costs
          automatically.
        </p>
        <label style="display:block; margin-top:16px; margin-bottom:12px;">
          <input type="checkbox" id="show-advanced-toggle" /> Show advanced
          details
        </label>
        <p class="settings-note">
          Display margin %, batch cost and ingredient breakdown by default. Turn
          off for a simpler view.
        </p>
      </div>
      <!-- Data settings -->
      <div class="settings-box" id="settings-data">
        <div class="settings-title" data-i18n="settings_data">Data &amp; Local Storage</div>
        <p class="text-muted" style="margin-bottom:16px;">
          ProfitPlate keeps everything in your browser. No server, no cloud.
        </p>
        <div style="margin-bottom:16px;">
          <h3 style="margin:0 0 8px; font-size:1.1rem;">Demo Data</h3>
          <button id="remove-demo-btn" class="btn btn-secondary">
            Remove Demo Items
          </button>
        </div>

        <!-- Import / Export section -->
        <div style="margin-bottom:16px;">
          <h3 style="margin:0 0 8px; font-size:1.1rem;">Import/Export</h3>
          <button id="export-data-btn" class="btn btn-secondary" style="margin-right:8px;">
            Export Data
          </button>
          <button id="import-data-btn" class="btn btn-secondary">
            Import Data
          </button>
          <input type="file" id="import-data-file" accept=".json" style="display:none" />
        </div>
        <hr />
        <div class="danger-zone" style="margin-top:16px;">
          <h3 style="margin:0 0 8px; font-size:1.1rem;">Danger Zone</h3>
          <button id="delete-data-btn" class="btn btn-danger">
            Delete My Data
          </button>
          <p class="settings-note">
            Delete ALL your Purchases and Recipes. This cannot be undone.
          </p>
        </div>
      </div>
    </div>
    <!-- Scripts -->
    <script src="assets/header.js"></script>
    <script src="assets/app.js"></script>
    <script src="assets/tour.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        if (typeof renderHeader === 'function') renderHeader('settings');
        // After rendering the header, translate navigation and other text
        if (typeof translatePage === 'function') translatePage();
        // Populate currency options
        const currencySelect = document.getElementById('currency-select');
        const currencyOptions = [
          ['EUR', '€ – Euro'],
          ['RON', 'lei – Romanian leu'],
          ['USD', '$ – US Dollar'],
          ['GBP', '£ – British Pound'],
        ];
        currencyOptions.forEach(([value, label]) => {
          const opt = document.createElement('option');
          opt.value = value;
          opt.textContent = label;
          currencySelect.appendChild(opt);
        });
        // Load existing settings
        const settings = (window.loadSettings && window.loadSettings()) || {};
        currencySelect.value = settings.currency || 'EUR';
        document.getElementById('number-format-select').value =
          settings.locale === 'us' ? 'us' : 'eu';
        document.getElementById('auto-recalc-toggle').checked =
          settings.autoRecalc !== false;
        document.getElementById('show-advanced-toggle').checked =
          settings.showAdvanced !== false;
        // Save handlers
        currencySelect.addEventListener('change', function () {
          if (window.saveSettings) window.saveSettings({ currency: this.value });
        });
        document
          .getElementById('number-format-select')
          .addEventListener('change', function () {
            if (window.saveSettings) {
              window.saveSettings({ locale: this.value });
            }
          });
        document
          .getElementById('auto-recalc-toggle')
          .addEventListener('change', function () {
            if (window.saveSettings) {
              window.saveSettings({ autoRecalc: this.checked });
            }
          });
        document
          .getElementById('show-advanced-toggle')
          .addEventListener('change', function () {
            if (window.saveSettings) {
              window.saveSettings({ showAdvanced: this.checked });
            }
          });

        // Handle language selection
        const langSelect = document.getElementById('language-select');
        if (langSelect) {
          // Set current language from settings (defined above)
          langSelect.value = settings.language || 'en';
          langSelect.addEventListener('change', function () {
            if (window.saveSettings) {
              window.saveSettings({ language: this.value });
            }
            if (typeof translatePage === 'function') translatePage();
          });
        }
        // Export data handler
        const exportBtn = document.getElementById('export-data-btn');
        if (exportBtn) {
          exportBtn.addEventListener('click', function () {
            if (window.exportData) window.exportData();
          });
        }
        // Import data handler
        const importBtn = document.getElementById('import-data-btn');
        const importFile = document.getElementById('import-data-file');
        if (importBtn && importFile) {
          importBtn.addEventListener('click', function () {
            importFile.click();
          });
          importFile.addEventListener('change', function () {
            const file = importFile.files && importFile.files[0];
            if (file && window.importData) {
              window.importData(file);
            }
            // Clear file input value to allow re-importing the same file
            importFile.value = '';
          });
        }
        // Remove demo data
        document
          .getElementById('remove-demo-btn')
          .addEventListener('click', function () {
            if (window.ppStore && window.ppStore.removeDemoData) {
              window.ppStore.removeDemoData();
              alert('Demo items removed.');
            }
          });
        // Delete all data
        document
          .getElementById('delete-data-btn')
          .addEventListener('click', function () {
            if (
              confirm(
                'This will delete all purchases and recipes. This cannot be undone. Continue?'
              )
            ) {
              if (window.ppStore && window.ppStore.nukeUserData) {
                window.ppStore.nukeUserData();
                alert('All data deleted.');
              }
            }
          });
      });
    </script>
  </body>
</html>